<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>In Love üíñ</title>
  <!-- Favicon tr√°i tim -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text y='50' font-size='52'>üíñ</text></svg>">

  <style>
    :root{ --pink:#e75480; }
    body{
      margin:0; background:#fff; overflow:hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      height:100vh; gap:12px; cursor: crosshair;
    }
    .center-text, .counter{ position: relative; z-index: 20; user-select:none; color: var(--pink); text-align:center; }
    .center-text{ font-size:2.5rem; font-weight:500; }
    .counter{ font-size:1.5rem; font-weight:400; }

    .heart, .icon-burst{ position: fixed; left:0; top:0; transform: translate(-50%, -50%); pointer-events:none; will-change: transform, opacity; z-index: 5; }
    .heart svg{ display:block; filter: drop-shadow(0 2px 6px rgba(0,0,0,.2)); }
    .icon-burst{ font-size:32px; }

    .music-btn{
      position: fixed; right:14px; top:14px; z-index: 30;
      background:#fff; color:#111; border:1px solid rgba(0,0,0,.1);
      border-radius:999px; padding:8px 12px; font-weight:600; font-size:14px;
      box-shadow:0 6px 20px rgba(0,0,0,.06); cursor:pointer; user-select:none;
    }
    .music-btn.pulse{ animation:pulse 1.2s ease-in-out infinite; }
    @keyframes pulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.07)} }
  </style>
</head>
<body>
  <button class="music-btn" id="musicBtn" aria-pressed="false">üéµ B·∫≠t nh·∫°c</button>

  <div class="center-text" id="mainText">H·ªØu H∆∞ng ‚ù§Ô∏è Thu√Ω B√¨nh</div>
  <div class="counter" id="dayCounter">ƒê√£ b√™n nhau 0 ng√†y</div>

  <!-- Audio s·∫Ω ƒë∆∞·ª£c set src b·∫±ng playlist.json, kh√¥ng c·∫ßn s·ª≠a code khi th√™m b√†i -->
  <audio id="bgm" preload="auto"></audio>

  <div id="stage"></div>

  <template id="heartTpl">
    <div class="heart" aria-hidden="true">
      <svg viewBox="0 0 32 29" width="32" height="32">
        <path d="M23.6 0c-3 0-5.6 1.6-7.6 4C14 1.6 11.4 0 8.4 0 3.8 0 0 3.7 0 8.3c0 9.2 16 20.4 16 20.4S32 17.5 32 8.3C32 3.7 28.2 0 23.6 0z" fill="currentColor"/>
      </svg>
    </div>
  </template>

  <script>
    const stage = document.getElementById('stage');
    const tpl = document.getElementById('heartTpl');

    function rand(min, max){ return Math.random() * (max - min) + min; }

    // ===== Auto floating hearts =====
    function createHeart(x, y, color){
      const node = tpl.content.firstElementChild.cloneNode(true);
      const size = rand(16, 40);
      node.style.width = node.style.height = size + 'px';
      node.style.color = color || `hsl(${(rand(330, 380)) % 360} ${rand(70,95)}% ${rand(55,75)}%)`;

      const sway = rand(30, 120);
      const drift = rand(-sway, sway);
      const duration = rand(6, 12);
      const start = performance.now();
      const angle = rand(0, Math.PI*2);
      const rot = rand(-30, 30);
      const startX = x + drift;
      const startY = y;

      function frame(t){
        const k = (t - start) / (duration * 1000);
        if(k >= 1){ node.remove(); return; }
        const ease = 1 - Math.pow(1 - k, 2);
        const up = ease * (window.innerHeight * 0.9 + 100);
        const swayX = Math.sin(k * Math.PI * 2 + angle) * sway * (1 - k);
        node.style.transform = `translate(${startX + swayX}px, ${startY - up}px) rotate(${rot * (1-k)}deg)`;
        node.style.opacity = 1 - k;
        requestAnimationFrame(frame);
      }
      node.style.left = '0'; node.style.top = '0';
      stage.appendChild(node);
      requestAnimationFrame(frame);
    }

    function loop(t){
      const freq = 220;
      if(!window.lastSpawn || t - window.lastSpawn > freq){
        window.lastSpawn = t;
        const x = rand(0, window.innerWidth);
        const y = window.innerHeight + 20;
        createHeart(x, y);
      }
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    // ===== Click burst with fox & rabbit icons =====
    const ICONS = ['ü¶ä','üê∞'];

    function createIcon(x, y){
      const el = document.createElement('div');
      el.className = 'icon-burst';
      el.textContent = ICONS[Math.floor(Math.random() * ICONS.length)];
      el.style.fontSize = rand(28, 42) + 'px';

      const duration = rand(0.9, 1.6);
      const start = performance.now();
      const angle = rand(-Math.PI/2 - 0.7, -Math.PI/2 + 0.7);
      const speed = rand(220, 420);
      const gravity = 620;
      const spin = rand(-40, 40);
      const vx = Math.cos(angle) * speed;
      const vy = Math.sin(angle) * speed;

      function frame(t){
        const k = (t - start) / 1000;
        if(k >= duration){ el.remove(); return; }
        const dx = vx * k;
        const dy = vy * k + 0.5 * gravity * k * k;
        el.style.transform = `translate(${x + dx}px, ${y + dy}px) rotate(${spin * k}deg)`;
        el.style.opacity = 1 - (k / duration);
        requestAnimationFrame(frame);
      }
      el.style.left = '0'; el.style.top = '0';
      stage.appendChild(el);
      requestAnimationFrame(frame);
    }

    function burstAt(x, y, count = 12){
      for(let i=0;i<count;i++){
        const jitterX = rand(-25, 25);
        const jitterY = rand(-15, 15);
        createIcon(x + jitterX, y + jitterY);
      }
    }

    let holding = false, holdTimer;
    window.addEventListener('pointerdown', (e)=>{
      holding = true; burstAt(e.clientX, e.clientY, 12);
      clearInterval(holdTimer);
      holdTimer = setInterval(()=>{ if(holding) burstAt(e.clientX, e.clientY, 8); }, 200);
    });
    window.addEventListener('pointerup', ()=>{ holding = false; clearInterval(holdTimer); });

    // ===== Day counter =====
    const counterEl = document.getElementById('dayCounter');
    const startDate = new Date('2025-03-20T00:00:00');
    function updateCounter(){
      const now = new Date();
      const diff = now - startDate;

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      counterEl.textContent = `ƒê√£ b√™n nhau ${days} ng√†y ${hours} gi·ªù ${minutes} ph√∫t ${seconds} gi√¢y`;
    }
    updateCounter();
    setInterval(updateCounter, 1000);

    // ===== Music: click b·∫•t k·ª≥ ƒë·ªÉ ph√°t + playlist.json =====
    const audio = document.getElementById('bgm');
    const musicBtn = document.getElementById('musicBtn');

    let playlist = [];
    let currentIndex = 0;
    let kicked = false;

    async function loadPlaylist(){
      try{
        const res = await fetch('playlist.json', { cache: 'no-store' });
        if(res.ok){
          const data = await res.json();
          if(Array.isArray(data) && data.length){ playlist = data; }
        }
      }catch(e){ /* ignore, fallback below */ }
      if(playlist.length === 0){ playlist = ['iloveyou3000.mp3']; }
      audio.src = playlist[0];
    }

    function nextTrack(){
      if(!playlist.length) return;
      currentIndex = (currentIndex + 1) % playlist.length;
      audio.src = playlist[currentIndex];
      audio.play().catch(()=>{});
    }

    // Click b·∫•t k·ª≥ ƒë·ªÉ ph√°t nh·∫°c l·∫ßn ƒë·∫ßu
    const firstKick = async () => {
      if(kicked) return; kicked = true;
      try { await audio.play(); musicBtn.textContent = 'üéµ ƒêang ph√°t'; musicBtn.setAttribute('aria-pressed','true'); musicBtn.classList.remove('pulse'); }
      catch(e) { kicked = false; }
      window.removeEventListener('pointerdown', firstKick);
      window.removeEventListener('keydown', firstKick);
      window.removeEventListener('touchstart', firstKick);
    };

    musicBtn.addEventListener('click', async ()=>{
      if(audio.paused){ await firstKick(); }
      else{ audio.pause(); musicBtn.textContent = 'üéµ B·∫≠t nh·∫°c'; musicBtn.setAttribute('aria-pressed','false'); }
    });

    audio.addEventListener('ended', nextTrack);

    window.addEventListener('pointerdown', firstKick, { once:true });
    window.addEventListener('keydown', firstKick, { once:true });
    window.addEventListener('touchstart', firstKick, { once:true });

    // Load danh s√°ch b√†i khi m·ªü trang
    loadPlaylist();
  </script>
</body>
</html>
